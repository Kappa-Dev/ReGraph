
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>regraph.backends.networkx.hierarchies &#8212; ReGraph 3.0 documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for regraph.backends.networkx.hierarchies</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;NetworkX-based in-memory graph hierarchy objects.</span>

<span class="sd">This module contains a data structure implementing</span>
<span class="sd">graph hierarchies based on NetworkX graphs.</span>

<span class="sd">* `NXHierarchy` -- class for in-memort graph hierarchies.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">regraph.exceptions</span> <span class="k">import</span> <span class="p">(</span><span class="n">HierarchyError</span><span class="p">,</span>
                                <span class="n">ReGraphError</span><span class="p">,</span>
                                <span class="n">InvalidHomomorphism</span><span class="p">,</span>
                                <span class="n">RewritingError</span><span class="p">,</span>
                                <span class="n">ReGraphWarning</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">regraph.hierarchies</span> <span class="k">import</span> <span class="n">Hierarchy</span>
<span class="kn">from</span> <span class="nn">regraph.backends.networkx.graphs</span> <span class="k">import</span> <span class="n">NXGraph</span>
<span class="kn">from</span> <span class="nn">regraph.category_utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">compose</span><span class="p">,</span>
                                    <span class="n">pushout</span><span class="p">,</span>
                                    <span class="n">get_unique_map_to_pullback</span><span class="p">,</span>
                                    <span class="n">check_homomorphism</span><span class="p">,</span>
                                    <span class="n">right_relation_dict</span><span class="p">,</span>
                                    <span class="n">pullback_complement</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">regraph.utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">normalize_attrs</span><span class="p">,</span>
                           <span class="n">normalize_relation</span><span class="p">,</span>
                           <span class="n">keys_by_value</span><span class="p">,)</span>


<div class="viewcode-block" id="NXHierarchy"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy">[docs]</a><span class="k">class</span> <span class="nc">NXHierarchy</span><span class="p">(</span><span class="n">Hierarchy</span><span class="p">,</span> <span class="n">NXGraph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for in-memory hierarchies.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rel_dict_factory</span> <span class="o">=</span> <span class="nb">dict</span>

    <span class="c1"># Implementation of abstract methods</span>

<div class="viewcode-block" id="NXHierarchy.graphs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.graphs">[docs]</a>    <span class="k">def</span> <span class="nf">graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of graphs in the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n_data</span><span class="p">[</span><span class="s2">&quot;attrs&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">n_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;graph&quot;</span> <span class="ow">in</span> <span class="n">n_data</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">n_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;graph&quot;</span> <span class="ow">in</span> <span class="n">n_data</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.typings"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.typings">[docs]</a>    <span class="k">def</span> <span class="nf">typings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of graph typing edges in the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">e_data</span><span class="p">[</span><span class="s2">&quot;attrs&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">e_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;mapping&quot;</span> <span class="ow">in</span> <span class="n">e_data</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">e_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;mapping&quot;</span> <span class="ow">in</span> <span class="n">e_data</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.relations"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.relations">[docs]</a>    <span class="k">def</span> <span class="nf">relations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of relations.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>

<div class="viewcode-block" id="NXHierarchy.successors"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.successors">[docs]</a>    <span class="k">def</span> <span class="nf">successors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the set of successors.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.predecessors"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.predecessors">[docs]</a>    <span class="k">def</span> <span class="nf">predecessors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the set of predecessors.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.get_graph"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_graph">[docs]</a>    <span class="k">def</span> <span class="nf">get_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a graph object associated to the node &#39;graph_id&#39;.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">graph_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Hierarchy node &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">graph_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Hierarchy node &#39;</span><span class="si">{}</span><span class="s2">&#39; is a rule!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">graph_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">graph_id</span><span class="p">][</span><span class="s2">&quot;graph&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.get_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_typing">[docs]</a>    <span class="k">def</span> <span class="nf">get_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a typing dict associated to the edge &#39;source-&gt;target&#39;.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)[</span><span class="s2">&quot;mapping&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="s2">&quot;lhs_mapping&quot;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s2">&quot;rhs_mapping&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                    <span class="s2">&quot;No path from &#39;</span><span class="si">{}</span><span class="s2">&#39; to &#39;</span><span class="si">{}</span><span class="s2">&#39; in the hierarchy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.get_relation"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_relation">[docs]</a>    <span class="k">def</span> <span class="nf">get_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a relation dict associated to the rel &#39;left-right&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)][</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.get_graph_attrs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_graph_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">get_graph_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get attributes of a graph in the hierarchy.</span>

<span class="sd">        graph_id : hashable</span>
<span class="sd">            Id of the graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)[</span><span class="s2">&quot;attrs&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.set_graph_attrs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.set_graph_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">set_graph_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set attributes of a graph in the hierarchy.</span>

<span class="sd">        graph_id : hashable</span>
<span class="sd">            Id of the graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_node_attrs</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">attrs</span><span class="p">})</span></div>

<div class="viewcode-block" id="NXHierarchy.get_typing_attrs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_typing_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">get_typing_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get attributes of a typing in the hierarchy.</span>

<span class="sd">        source : hashable</span>
<span class="sd">            Id of the source graph</span>
<span class="sd">        target : hashable</span>
<span class="sd">            Id of the target graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)[</span><span class="s2">&quot;attrs&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.set_typing_attrs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.set_typing_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">set_typing_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set attributes of a typing in the hierarchy.</span>

<span class="sd">        source : hashable</span>
<span class="sd">            Id of the source graph</span>
<span class="sd">        target : hashable</span>
<span class="sd">            Id of the target graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_edge_attrs</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">attrs</span><span class="p">})</span></div>

<div class="viewcode-block" id="NXHierarchy.get_relation_attrs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_relation_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">get_relation_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get attributes of a reltion in the hierarchy.</span>

<span class="sd">        left : hashable</span>
<span class="sd">            Id of the left graph</span>
<span class="sd">        right : hashable</span>
<span class="sd">            Id of the right graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)][</span><span class="s2">&quot;attrs&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.set_relation_attrs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.set_relation_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">set_relation_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set attributes of a relation in the hierarchy.</span>

<span class="sd">        left : hashable</span>
<span class="sd">            Id of the left graph</span>
<span class="sd">        right : hashable</span>
<span class="sd">            Id of the right graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">normalize_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)][</span><span class="s2">&quot;attrs&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">)][</span><span class="s2">&quot;attrs&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></div>

<div class="viewcode-block" id="NXHierarchy.set_node_relation"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.set_node_relation">[docs]</a>    <span class="k">def</span> <span class="nf">set_node_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_graph</span><span class="p">,</span> <span class="n">right_graph</span><span class="p">,</span>
                          <span class="n">left_node</span><span class="p">,</span> <span class="n">right_node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set relation to a particular node.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">left_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span>
                <span class="n">left_graph</span><span class="p">,</span> <span class="n">right_graph</span><span class="p">][</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span><span class="n">left_graph</span><span class="p">,</span> <span class="n">right_graph</span><span class="p">][</span><span class="s2">&quot;rel&quot;</span><span class="p">][</span><span class="n">left_node</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">right_node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span><span class="n">left_graph</span><span class="p">,</span> <span class="n">right_graph</span><span class="p">][</span><span class="s2">&quot;rel&quot;</span><span class="p">][</span><span class="n">left_node</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">right_node</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">right_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span>
                <span class="n">right_graph</span><span class="p">,</span> <span class="n">left_graph</span><span class="p">][</span><span class="s2">&quot;rel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span>
                <span class="n">right_graph</span><span class="p">,</span> <span class="n">left_graph</span><span class="p">][</span><span class="s2">&quot;rel&quot;</span><span class="p">][</span><span class="n">right_node</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">left_node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span><span class="n">right_graph</span><span class="p">,</span> <span class="n">left_graph</span><span class="p">][</span><span class="s2">&quot;rel&quot;</span><span class="p">][</span><span class="n">right_node</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">left_node</span><span class="p">}</span></div>

<div class="viewcode-block" id="NXHierarchy.add_graph"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.add_graph">[docs]</a>    <span class="k">def</span> <span class="nf">add_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">graph_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new graph to the hierarchy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            Id of a new node in the hierarchy</span>
<span class="sd">        graph : regraph.Graph</span>
<span class="sd">            Graph object corresponding to the new node of</span>
<span class="sd">            the hierarchy</span>
<span class="sd">        graph_attrs : dict, optional</span>
<span class="sd">            Dictionary containing attributes of the new node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">graph_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; already exists in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">graph_id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">graph_attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normalize_attrs</span><span class="p">(</span><span class="n">graph_attrs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph_attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_node_attrs</span><span class="p">(</span>
            <span class="n">graph_id</span><span class="p">,</span> <span class="p">{</span>
                <span class="s2">&quot;graph&quot;</span><span class="p">:</span> <span class="n">graph</span><span class="p">,</span>
                <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">graph_attrs</span>
            <span class="p">},</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="NXHierarchy.add_empty_graph"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.add_empty_graph">[docs]</a>    <span class="k">def</span> <span class="nf">add_empty_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Add a new empty graph to the hierarchy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            Id of a new node in the hierarchy</span>
<span class="sd">        graph_attrs : dict, optional</span>
<span class="sd">            Dictionary containing attributes of the new node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">NXGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.add_graph_from_data"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.add_graph_from_data">[docs]</a>    <span class="k">def</span> <span class="nf">add_graph_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">node_list</span><span class="p">,</span> <span class="n">edge_list</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new graph to the hierarchy from the input node/edge lists.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            Id of a new node in the hierarchy</span>
<span class="sd">        node_list : iterable</span>
<span class="sd">            List of nodes (with attributes)</span>
<span class="sd">        edge_list : iterable</span>
<span class="sd">            List of edges (with attributes)</span>
<span class="sd">        graph_attrs : dict, optional</span>
<span class="sd">            Dictionary containing attributes of the new node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_empty_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edge_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.add_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.add_typing">[docs]</a>    <span class="k">def</span> <span class="nf">add_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add homomorphism to the hierarchy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        source : hashable</span>
<span class="sd">            Id of the source graph node of typing</span>
<span class="sd">        target : hashable</span>
<span class="sd">            Id of the target graph node of typing</span>
<span class="sd">        mapping : dict</span>
<span class="sd">            Dictionary representing a mapping of nodes</span>
<span class="sd">            from the source graph to target&#39;s nodes</span>
<span class="sd">        attrs : dict, optional</span>
<span class="sd">            Dictionary containing attributes of the new</span>
<span class="sd">            typing edge. Empty by default</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HierarchyError</span>
<span class="sd">            This error is raised in the following cases:</span>

<span class="sd">                * source or target ids are not found in the hierarchy</span>
<span class="sd">                * a typing edge between source and target already exists</span>
<span class="sd">                * addition of an edge between source and target creates</span>
<span class="sd">                a cycle or produces paths that do not commute with</span>
<span class="sd">                some already existing paths</span>

<span class="sd">        InvalidHomomorphism</span>
<span class="sd">            If a homomorphisms from a graph at the source to a graph at</span>
<span class="sd">            the target given by `mapping` is not a valid homomorphism.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Edge &#39;</span><span class="si">{}</span><span class="s2">-&gt;</span><span class="si">{}</span><span class="s2">&#39; already exists in the hierarchy: &quot;</span>
                <span class="s2">&quot;no muliple edges allowed!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Source of a typing should be a graph,&quot;</span>
                <span class="s2">&quot; &#39;</span><span class="si">{}</span><span class="s2">&#39; is provided!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">source</span><span class="p">]))</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Target of a typing should be a graph, &quot;</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is provided!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">target</span><span class="p">]))</span>
            <span class="p">)</span>

        <span class="c1"># check no cycles are produced</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_directed_acyclic_graph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Edge &#39;</span><span class="si">{}</span><span class="s2">-&gt;</span><span class="si">{}</span><span class="s2">&#39; creates a cycle in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="c1"># check if the homomorphism is valid</span>
        <span class="n">check_homomorphism</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">source</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">target</span><span class="p">),</span>
            <span class="n">mapping</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># check if newly created path commutes with existing shortest paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_consistency</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normalize_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_edge</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="p">{</span>
                <span class="s2">&quot;mapping&quot;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">,</span>
                <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">attrs</span>
            <span class="p">},</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="NXHierarchy.add_relation"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.add_relation">[docs]</a>    <span class="k">def</span> <span class="nf">add_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add relation to the hierarchy.</span>

<span class="sd">        This method adds a relation between two graphs in</span>
<span class="sd">        the hierarchy corresponding to the nodes with ids</span>
<span class="sd">        `left` and `right`, the relation itself is defined</span>
<span class="sd">        by a dictionary `relation`, where a key is a node in</span>
<span class="sd">        the `left` graph and its corresponding value is a set</span>
<span class="sd">        of nodes from the `right` graph to which the node is</span>
<span class="sd">        related. Relations in the hierarchy are symmetric</span>
<span class="sd">        (see example below).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        left</span>
<span class="sd">            Id of the hierarchy&#39;s node represening the `left` graph</span>
<span class="sd">        right</span>
<span class="sd">            Id of the hierarchy&#39;s node represening the `right` graph</span>
<span class="sd">        relation : dict</span>
<span class="sd">            Dictionary representing a relation of nodes from `left`</span>
<span class="sd">            to the nodes from `right`, a key of the dictionary is</span>
<span class="sd">            assumed to be a node from `left` and its value a set</span>
<span class="sd">            of ids of related nodes from `right`</span>
<span class="sd">        attrs : dict</span>
<span class="sd">            Dictionary containing attributes of the new relation</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HierarchyError</span>
<span class="sd">            This error is raised in the following cases:</span>

<span class="sd">                * node with id `left`/`right` is not defined in the hierarchy;</span>
<span class="sd">                * node with id `left`/`right` is not a graph;</span>
<span class="sd">                * a relation between `left` and `right` already exists;</span>
<span class="sd">                * some node ids specified in `relation` are not found in the</span>
<span class="sd">                `left`/`right` graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">left</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">left</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">right</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">left</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Relation can be defined only on graph objects&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">right</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Relation can be defined only on graph objects&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Relation &#39;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&#39; already exists in the hierarchy &quot;</span>
                <span class="s2">&quot;multiple edges are not allowed!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># normalize relation dict</span>
        <span class="n">relation</span> <span class="o">=</span> <span class="n">normalize_relation</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span>

        <span class="c1"># check relation is well-defined on left and right side</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">relation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                    <span class="s2">&quot;Relation is not valid: node &#39;</span><span class="si">{}</span><span class="s2">&#39; does not &quot;</span>
                    <span class="s2">&quot;exist in a graph &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                        <span class="s2">&quot;Relation is not valid: node &#39;</span><span class="si">{}</span><span class="s2">&#39; does not &quot;</span>
                        <span class="s2">&quot;exist in a graph &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normalize_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">relation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">pairs</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">right_relation</span> <span class="o">=</span> <span class="n">right_relation_dict</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
        <span class="n">rel_ab_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rel&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">,</span>
            <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">attrs</span>
        <span class="p">}</span>
        <span class="n">rel_ba_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rel&quot;</span><span class="p">:</span> <span class="n">right_relation</span><span class="p">,</span>
            <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">attrs</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span> <span class="n">rel_ab_dict</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">):</span> <span class="n">rel_ba_dict</span><span class="p">})</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="NXHierarchy.remove_graph"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.remove_graph">[docs]</a>    <span class="k">def</span> <span class="nf">remove_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">reconnect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove graph from the hierarchy.</span>

<span class="sd">        Removes a graph from the hierarchy, if the `reconnect`</span>
<span class="sd">        parameter is set to True, adds typing from the</span>
<span class="sd">        predecessors of the removed node to all its successors,</span>
<span class="sd">        by composing the homomorphisms (for every predecessor `p`</span>
<span class="sd">        and for every successor &#39;s&#39; composes two homomorphisms</span>
<span class="sd">        `p`-&gt;`node_id` and `node_id`-&gt;`s`, then removes `node_id` and</span>
<span class="sd">        all its incident edges, by which makes node&#39;s</span>
<span class="sd">        removal a procedure of &#39;forgetting&#39; one level</span>
<span class="sd">        of &#39;abstraction&#39;).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph_id</span>
<span class="sd">            Id of a graph to remove</span>
<span class="sd">        reconnect : bool</span>
<span class="sd">            Reconnect the descendants of the removed node to</span>
<span class="sd">            its predecessors</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HierarchyError</span>
<span class="sd">            If graph with `node_id` is not defined in the hierarchy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Hierarchy node &#39;</span><span class="si">{}</span><span class="s2">&#39; is a rule! &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span> <span class="o">+</span>
                <span class="s2">&quot;Use, &#39;remove_rule&#39; method instead&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">reconnect</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.remove_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.remove_typing">[docs]</a>    <span class="k">def</span> <span class="nf">remove_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a typing from the hierarchy.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.remove_relation"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.remove_relation">[docs]</a>    <span class="k">def</span> <span class="nf">remove_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a relation from the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">()</span> <span class="ow">and</span>\
           <span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Relation &#39;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&#39; is not defined in the hierarchy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.bfs_tree"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.bfs_tree">[docs]</a>    <span class="k">def</span> <span class="nf">bfs_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;BFS tree from the graph to all other reachable graphs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">bfs_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">))[</span><span class="mi">1</span><span class="p">:]</span></div>

<div class="viewcode-block" id="NXHierarchy.shortest_path"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.shortest_path">[docs]</a>    <span class="k">def</span> <span class="nf">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shortest path from &#39;source&#39; to &#39;target&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.copy_graph"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.copy_graph">[docs]</a>    <span class="k">def</span> <span class="nf">copy_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">new_graph_id</span><span class="p">,</span> <span class="n">attach_graphs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a copy of a graph in a hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attach_graphs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attach_graphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">new_graph_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Graph with id &#39;</span><span class="si">{}</span><span class="s2">&#39; already exists in the hierarchy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">new_graph_id</span><span class="p">))</span>
        <span class="n">graph_copy</span> <span class="o">=</span> <span class="n">NXGraph</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_graph</span><span class="p">(</span>
            <span class="n">new_graph_id</span><span class="p">,</span> <span class="n">graph_copy</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_graph_attrs</span><span class="p">(</span><span class="n">graph_id</span><span class="p">))</span>

        <span class="c1"># copy all typings to/from attach_graphs</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">attach_graphs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_typing</span><span class="p">(</span><span class="n">new_graph_id</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_typing</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">new_graph_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacent_relations</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_relation</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">new_graph_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relation</span><span class="p">(</span>
                    <span class="n">g</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="NXHierarchy.relabel_graph_node"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.relabel_graph_node">[docs]</a>    <span class="k">def</span> <span class="nf">relabel_graph_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rename a node in a graph of the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ReGraphError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; already exists in the graph &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">new_name</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ReGraphError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist in the graph &#39;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">node</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">relabel_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">)</span>
            <span class="n">new_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">new_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_mapping</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">new_mapping</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">suc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">suc</span><span class="p">)</span>
            <span class="n">new_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">new_mapping</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_mapping</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">suc</span><span class="p">,</span> <span class="n">new_mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.relabel_graph"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.relabel_graph">[docs]</a>    <span class="k">def</span> <span class="nf">relabel_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">new_graph_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Relabel a graph in the hierarchy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            Id of the graph to relabel</span>
<span class="sd">        new_graph_id : hashable</span>
<span class="sd">            New graph id to assign to this graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relabel_node</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">new_graph_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.relabel_graphs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.relabel_graphs">[docs]</a>    <span class="k">def</span> <span class="nf">relabel_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Relabel graphs in the hierarchy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mapping: dict</span>
<span class="sd">            A dictionary with keys being old graph ids and their values</span>
<span class="sd">            being new id&#39;s of the respective graphs.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ReGraphError</span>
<span class="sd">            If new id&#39;s do not define a set of distinct graph id&#39;s.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unique_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">ReGraphError</span><span class="p">(</span>
                <span class="s2">&quot;Attempt to relabel nodes failed: the IDs are not unique!&quot;</span><span class="p">)</span>

        <span class="n">temp_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Relabeling of the nodes: if at some point new ID conflicts</span>
        <span class="c1"># with already existing ID - assign temp ID</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                    <span class="n">new_name</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_new_node_id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">temp_names</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relabel_node</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
        <span class="c1"># Relabeling the nodes with the temp ID to their new IDs</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">temp_names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relabel_node</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span></div>

    <span class="k">def</span> <span class="nf">_check_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">all_paths</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">all_pairs_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">))</span>

        <span class="n">paths_to_source</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">paths_from_target</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">paths_to_source</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_paths</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">source</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">paths_from_target</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_paths</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">paths_to_source</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">paths_to_source</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">paths_from_target</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># find homomorphism from s to t via new path</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">source</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                            <span class="s2">&quot;Found a rule typing some node in the self!&quot;</span>
                        <span class="p">)</span>
                    <span class="n">new_lhs_h</span><span class="p">,</span> <span class="n">new_rhs_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span>
                        <span class="n">paths_to_source</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
                    <span class="n">new_lhs_h</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">new_lhs_h</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
                    <span class="n">new_rhs_h</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">new_rhs_h</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">target</span><span class="p">:</span>
                        <span class="n">new_lhs_h</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                            <span class="n">new_lhs_h</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">paths_from_target</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                        <span class="p">)</span>
                        <span class="n">new_rhs_h</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                            <span class="n">new_rhs_h</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">paths_from_target</span><span class="p">[</span><span class="n">t</span><span class="p">]),</span>
                        <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># find homomorphisms from s to t via other paths</span>
                        <span class="n">s_t_paths</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">all_shortest_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">s_t_paths</span><span class="p">:</span>
                            <span class="n">lhs_h</span><span class="p">,</span> <span class="n">rhs_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">lhs_h</span> <span class="o">!=</span> <span class="n">new_lhs_h</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                                    <span class="s2">&quot;Invalid lhs typing: homomorphism does &quot;</span>
                                    <span class="s2">&quot;not commute with an existing &quot;</span> <span class="o">+</span>
                                    <span class="s2">&quot;path from &#39;</span><span class="si">{}</span><span class="s2">&#39; to &#39;</span><span class="si">{}</span><span class="s2">&#39;!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="p">)</span>
                            <span class="k">if</span> <span class="n">rhs_h</span> <span class="o">!=</span> <span class="n">new_rhs_h</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                                    <span class="s2">&quot;Invalid rhs typing: homomorphism does &quot;</span>
                                    <span class="s2">&quot;not commute with an existing &quot;</span> <span class="o">+</span>
                                    <span class="s2">&quot;path from &#39;</span><span class="si">{}</span><span class="s2">&#39; to &#39;</span><span class="si">{}</span><span class="s2">&#39;!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="p">)</span>
                    <span class="k">except</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">):</span>
                        <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">paths_from_target</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># find homomorphism from s to t via new path</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">source</span><span class="p">:</span>
                        <span class="n">new_homomorphism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span>
                            <span class="n">paths_to_source</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_homomorphism</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                                                 <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
                    <span class="n">new_homomorphism</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                        <span class="n">new_homomorphism</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">target</span><span class="p">:</span>
                        <span class="n">new_homomorphism</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                            <span class="n">new_homomorphism</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">paths_from_target</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                        <span class="p">)</span>

                    <span class="c1"># find homomorphisms from s to t via other paths</span>
                    <span class="n">s_t_paths</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">all_shortest_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># check only the first path</span>
                        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">s_t_paths</span><span class="p">:</span>
                            <span class="n">path_homomorphism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">path_homomorphism</span> <span class="o">!=</span> <span class="n">new_homomorphism</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                                    <span class="s2">&quot;Homomorphism does not commute with an &quot;</span> <span class="o">+</span>
                                    <span class="s2">&quot;existing path from &#39;</span><span class="si">{}</span><span class="s2">&#39; to &#39;</span><span class="si">{}</span><span class="s2">&#39;!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="p">)</span>
                    <span class="k">except</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">):</span>
                            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_propagate_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">p_origin_m</span><span class="p">,</span>
                         <span class="n">origin_m_origin</span><span class="p">,</span> <span class="n">p_typing</span><span class="p">,</span>
                         <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagate clones from &#39;origin_id&#39; to &#39;graph_id&#39;.</span>

<span class="sd">        Perform a controlled propagation of clones to &#39;graph&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        origin_id : hashable</span>
<span class="sd">            ID of the graph corresponding to the origin of rewriting</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            ID of the graph where propagation is performed</span>
<span class="sd">        p_origin_m : dict</span>
<span class="sd">            Instance of rule&#39;s interface inside the updated origin</span>
<span class="sd">        origin_m_origin : dict</span>
<span class="sd">            Map from the updated origin to the initial origin</span>
<span class="sd">        p_typing : dict</span>
<span class="sd">            Controlling relation from the nodes of &#39;graph_id&#39; to</span>
<span class="sd">            the nodes of the interfaces</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        g_m_g : dict</span>
<span class="sd">            Map from the updated &#39;graph_id&#39; to the &#39;graph_id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
            <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_clone</span><span class="p">(</span>
                <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">p_origin_m</span><span class="p">,</span>
                <span class="n">origin_m_origin</span><span class="p">,</span> <span class="n">p_typing</span><span class="p">,</span>
                <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cloned_origin_nodes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">origin_m_origin</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">clones</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">origin_m_origin</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clones</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cloned_origin_nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">clones</span>

            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
            <span class="n">origin_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">)</span>

            <span class="n">lhs_m_lhs</span> <span class="o">=</span> <span class="n">g_m_g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p_m_p</span> <span class="o">=</span> <span class="n">g_m_g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">rhs_m_rhs</span> <span class="o">=</span> <span class="n">g_m_g</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">lhs_m_origin_m</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rhs_m_origin_m</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">p_typing</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Non-empty typing of the rule &#39;</span><span class="si">{}</span><span class="s2">&#39; by &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">node_id</span><span class="p">),</span>
                    <span class="s2">&quot;the interface: non-canonical propagation to rules is not &quot;</span>
                    <span class="s2">&quot;implemented, typing is ignored&quot;</span><span class="p">,</span>
                    <span class="n">ReGraphWarning</span><span class="p">)</span>

            <span class="n">p_origin_typing</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">n</span><span class="p">:</span> <span class="n">origin_typing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">cloned_lhs_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produce_clones</span><span class="p">(</span>
                <span class="n">cloned_origin_nodes</span><span class="p">,</span> <span class="n">p_origin_m</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span> <span class="n">origin_typing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">{},</span> <span class="n">lhs_m_lhs</span><span class="p">,</span> <span class="n">lhs_m_origin_m</span><span class="p">)</span>

            <span class="n">cloned_p_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produce_clones</span><span class="p">(</span>
                <span class="n">cloned_origin_nodes</span><span class="p">,</span> <span class="n">p_origin_m</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
                <span class="n">p_origin_typing</span><span class="p">,</span>
                <span class="p">{},</span> <span class="n">p_m_p</span><span class="p">,</span> <span class="p">{</span>
                    <span class="n">n</span><span class="p">:</span> <span class="n">lhs_m_origin_m</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
                <span class="p">})</span>

            <span class="n">cloned_rhs_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produce_clones</span><span class="p">(</span>
                <span class="n">cloned_origin_nodes</span><span class="p">,</span> <span class="n">p_origin_m</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span>
                <span class="n">origin_typing</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{},</span>
                <span class="n">rhs_m_rhs</span><span class="p">,</span> <span class="n">rhs_m_origin_m</span><span class="p">)</span>

            <span class="c1"># restore rule homomorphisms</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p_node</span> <span class="ow">in</span> <span class="n">cloned_p_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">original_p_node</span> <span class="o">=</span> <span class="n">p_m_p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="n">original_lhs_node</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">original_p_node</span><span class="p">]</span>
                <span class="n">original_rhs_node</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">p_rhs</span><span class="p">[</span><span class="n">original_p_node</span><span class="p">]</span>
                <span class="n">lhs_clones</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">cloned_lhs_nodes</span><span class="p">,</span> <span class="n">p_node</span><span class="p">)</span>
                <span class="n">rhs_clones</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">cloned_rhs_nodes</span><span class="p">,</span> <span class="n">p_node</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">lhs_clone</span> <span class="ow">in</span> <span class="n">lhs_clones</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lhs_m_lhs</span><span class="p">[</span><span class="n">lhs_clone</span><span class="p">]</span> <span class="o">==</span> <span class="n">original_lhs_node</span><span class="p">:</span>
                        <span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">lhs_clone</span>
                        <span class="k">break</span>
                <span class="k">for</span> <span class="n">rhs_clone</span> <span class="ow">in</span> <span class="n">rhs_clones</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rhs_m_rhs</span><span class="p">[</span><span class="n">rhs_clone</span><span class="p">]</span> <span class="o">==</span> <span class="n">original_rhs_node</span><span class="p">:</span>
                        <span class="n">rule</span><span class="o">.</span><span class="n">p_rhs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs_clone</span>
                        <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_restrictive_update_incident_homs</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restrictive_update_incident_rels</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span>

    <span class="k">def</span> <span class="nf">_propagate_node_removal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span>
                                <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagate node removal from &#39;origin_id&#39; to &#39;graph_id&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        origin_id : hashable</span>
<span class="sd">            ID of the graph corresponding to the origin of rewriting</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            ID of the graph where propagation is performed</span>
<span class="sd">        origin_m_origin : dict</span>
<span class="sd">            Map from the updated origin to the initial origin</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        g_m_g : dict</span>
<span class="sd">            Map from the updated &#39;graph_id&#39; to the &#39;graph_id&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
            <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_node_removal</span><span class="p">(</span>
                <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span>
                <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">object_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
            <span class="n">origin_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lhs_node</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">removed_nodes</span><span class="p">():</span>
                <span class="n">origin_n</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="n">lhs_node</span><span class="p">]</span>
                <span class="n">lhs_nodes</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">origin_typing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">origin_n</span><span class="p">)</span>
                <span class="n">p_nodes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">in</span> <span class="n">lhs_nodes</span><span class="p">]</span>
                <span class="n">rhs_nodes</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">origin_typing</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin_n</span><span class="p">)</span>
                <span class="n">lhs_m_lhs</span> <span class="o">=</span> <span class="n">g_m_g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">p_m_p</span> <span class="o">=</span> <span class="n">g_m_g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">rhs_m_rhs</span> <span class="o">=</span> <span class="n">g_m_g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">lhs_m_origin_m</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">p_m_origin_m</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">rhs_m_origin_m</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">lhs_nodes</span><span class="p">:</span>
                    <span class="n">object_rule</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">lhs_m_lhs</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">lhs_m_origin_m</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">p_nodes</span><span class="p">:</span>
                    <span class="n">object_rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">p_m_p</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">p_m_origin_m</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">rhs_nodes</span><span class="p">:</span>
                    <span class="n">object_rule</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">rhs_m_rhs</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">rhs_m_origin_m</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_restrictive_update_incident_homs</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restrictive_update_incident_rels</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_m</span>

    <span class="k">def</span> <span class="nf">_propagate_node_attrs_removal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span>
                                      <span class="n">p_origin_m</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagate node attrs removal from &#39;origin_id&#39; to &#39;graph_id&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        origin_id : hashable</span>
<span class="sd">            ID of the graph corresponding to the origin of rewriting</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            ID of the graph where propagation is performed</span>
<span class="sd">        rule : regraph.Rule</span>
<span class="sd">            Original rewriting rule</span>
<span class="sd">        instance : dict</span>
<span class="sd">            Original instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_node_attrs_removal</span><span class="p">(</span>
                <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span>
                <span class="n">p_origin_m</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1"># object_rule = self.get_rule(node_id)</span>
            <span class="c1"># origin_typing = self.get_typing(node_id, origin_id)</span>

            <span class="c1"># for lhs_node, attrs in rule.removed_node_attrs().items():</span>
            <span class="c1">#     lhs_nodes_to_remove_attrs = keys_by_value(</span>
            <span class="c1">#         origin_typing[0], instance[lhs_node])</span>
            <span class="c1">#     for node in lhs_nodes_to_remove_attrs:</span>
            <span class="c1">#         object_rule.lhs.remove_node_attrs(node, attrs)</span>
            <span class="c1">#     p_nodes_to_remove_attrs = [</span>
            <span class="c1">#         n for n in object_rule.p.nodes()</span>
            <span class="c1">#         if object_rule.p_lhs[n] in lhs_nodes_to_remove_attrs]</span>
            <span class="c1">#     for node in p_nodes_to_remove_attrs:</span>
            <span class="c1">#         object_rule.p.remove_node_attrs(node, attrs)</span>
            <span class="c1">#     rhs_nodes_to_remove_attrs = keys_by_value(</span>
            <span class="c1">#         origin_typing[1], instance[lhs_node])</span>
            <span class="c1">#     for node in rhs_nodes_to_remove_attrs:</span>
            <span class="c1">#         object_rule.rhs.remove_node_attrs(node, attrs)</span>

    <span class="k">def</span> <span class="nf">_propagate_edge_removal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagate edge removal from &#39;origin_id&#39; to &#39;graph_id&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        origin_id : hashable</span>
<span class="sd">            ID of the graph corresponding to the origin of rewriting</span>
<span class="sd">        node_id : hashable</span>
<span class="sd">            ID of the node where propagation is performed</span>
<span class="sd">        p_origin_m : dict</span>
<span class="sd">            Instance of rule&#39;s interface inside the updated origin</span>
<span class="sd">        origin_m_origin : dict</span>
<span class="sd">            Map from the updated origin to the initial origin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_edge_removal</span><span class="p">(</span><span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">g_m_origin_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
            <span class="n">origin_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">origin_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                <span class="n">origin_s</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
                <span class="n">origin_t</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">origin_s</span><span class="p">,</span> <span class="n">origin_t</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">origin_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                    <span class="n">rule</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                <span class="n">origin_s</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span>
                <span class="n">origin_t</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">origin_s</span><span class="p">,</span> <span class="n">origin_t</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">origin_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                    <span class="n">rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                <span class="n">origin_s</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
                <span class="n">origin_t</span> <span class="o">=</span> <span class="n">g_m_origin_m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">origin_s</span><span class="p">,</span> <span class="n">origin_t</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">origin_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                    <span class="n">rule</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_propagate_edge_attrs_removal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">p_origin_m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagate edge attrs removal from &#39;origin_id&#39; to &#39;graph_id&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        origin_id : hashable</span>
<span class="sd">            ID of the graph corresponding to the origin of rewriting</span>
<span class="sd">        graph_id : hashable</span>
<span class="sd">            ID of the graph where propagation is performed</span>
<span class="sd">        rule : regraph.Rule</span>
<span class="sd">            Original rewriting rule</span>
<span class="sd">        p_origin_m : dict</span>
<span class="sd">            Instance of rule&#39;s interface inside the updated origin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_propagate_edge_attrs_removal</span><span class="p">(</span>
                <span class="n">origin_id</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">p_origin_m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">object_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
            <span class="n">origin_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">origin_id</span><span class="p">)</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">p_u</span><span class="p">,</span> <span class="n">p_v</span><span class="p">),</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">removed_edge_attrs</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lhs_us</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">origin_typing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_origin_m</span><span class="p">[</span><span class="n">p_u</span><span class="p">])</span>
                <span class="n">lhs_vs</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">origin_typing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_origin_m</span><span class="p">[</span><span class="n">p_v</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">lhs_us</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lhs_vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                            <span class="n">object_rule</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">removed_edge_attrs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
                <span class="n">p_us</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">n</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span>
                    <span class="k">if</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">in</span> <span class="n">lhs_us</span><span class="p">]</span>
                <span class="n">p_vs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">n</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span>
                    <span class="k">if</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">in</span> <span class="n">lhs_vs</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">p_us</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p_vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                            <span class="n">object_rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">removed_edge_attrs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
                <span class="n">rhs_us</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">origin_typing</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_origin_m</span><span class="p">[</span><span class="n">p_u</span><span class="p">])</span>
                <span class="n">rhs_vs</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">origin_typing</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_origin_m</span><span class="p">[</span><span class="n">p_v</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">rhs_us</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rhs_vs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">object_rule</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                            <span class="n">object_rule</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">removed_edge_attrs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_rule_liftings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">p_typing</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_get_rule_projections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">rhs_typing</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># Implementation of the NXHierarchy-specific methods</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize in-memory hierarchy.&quot;&quot;&quot;</span>
        <span class="n">NXGraph</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rel_dict_factory</span> <span class="o">=</span> <span class="n">reldf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_dict_factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span> <span class="o">=</span> <span class="n">reldf</span><span class="p">()</span>

<div class="viewcode-block" id="NXHierarchy.rules"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.rules">[docs]</a>    <span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of rules in the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n_data</span><span class="p">[</span><span class="s2">&quot;attrs&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">n_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;rule&quot;</span> <span class="ow">in</span> <span class="n">n_data</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">n_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;rule&quot;</span> <span class="ow">in</span> <span class="n">n_data</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.rule_typings"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.rule_typings">[docs]</a>    <span class="k">def</span> <span class="nf">rule_typings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of rule typing edges in the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">e_data</span><span class="p">[</span><span class="s2">&quot;attrs&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">e_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;lhs_mapping&quot;</span> <span class="ow">in</span> <span class="n">e_data</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">e_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;lhs_mapping&quot;</span> <span class="ow">in</span> <span class="n">e_data</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.get_node_attrs"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_node_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get attributes of a node in the hierarchy.</span>

<span class="sd">        node_id : hashable</span>
<span class="sd">            Id of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">)[</span><span class="s2">&quot;attrs&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.get_rule"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_rule">[docs]</a>    <span class="k">def</span> <span class="nf">get_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a rule object associated to the node &#39;graph_id&#39;.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rule_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NXHierarchy.add_rule"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.add_rule">[docs]</a>    <span class="k">def</span> <span class="nf">add_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add rule to the hierarchy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rule_id : hashable</span>
<span class="sd">            Id of a new node in the hierarchy</span>
<span class="sd">        rule : regraph.rules.Rule</span>
<span class="sd">            Rule object corresponding to the new node of</span>
<span class="sd">            the hierarchy</span>
<span class="sd">        attrs : dict</span>
<span class="sd">            Dictionary containing attributes of the new node</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HierarchyError</span>
<span class="sd">            If the rule object is defined for directed/undirected</span>
<span class="sd">            graphs while the hierarchy&#39;s parameter `directed` is</span>
<span class="sd">            False/True (the hierarchy accommodates undirected/directed</span>
<span class="sd">            graphs) or if node with provided id already exists</span>
<span class="sd">            in the hierarchy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rule_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; already exists in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">rule_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normalize_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_node_attrs</span><span class="p">(</span>
            <span class="n">rule_id</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="p">,</span>
                <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">attrs</span>
            <span class="p">},</span>
            <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="NXHierarchy.add_rule_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.add_rule_typing">[docs]</a>    <span class="k">def</span> <span class="nf">add_rule_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">lhs_mapping</span><span class="p">,</span>
                        <span class="n">rhs_mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">lhs_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rhs_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add typing of a rule.</span>

<span class="sd">        source</span>
<span class="sd">            Id of a rule node to type</span>
<span class="sd">        target</span>
<span class="sd">            Id of a target graph node of typing</span>
<span class="sd">        lhs_mapping : dict</span>
<span class="sd">            Dictionary representing a mapping of nodes</span>
<span class="sd">            from the left-hand side of the rule to target&#39;s nodes</span>
<span class="sd">        rhs_mapping : dict</span>
<span class="sd">            Dictionary representing a mapping of nodes</span>
<span class="sd">            from the right-hand side of the rule to target&#39;s nodes</span>
<span class="sd">        lhs_total : bool</span>
<span class="sd">            True if left-hand side typing is total, False otherwise</span>
<span class="sd">        rhs_total : bool</span>
<span class="sd">            True if right-hand side typing is total, False otherwise</span>
<span class="sd">        attrs : dict</span>
<span class="sd">            Dictionary containing attributes of the new</span>
<span class="sd">            typing edge</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HierarchyError</span>
<span class="sd">            This error is raised in the following cases:</span>

<span class="sd">                * source or target ids are not found in the hierarchy</span>
<span class="sd">                * a typing edge between source and target already exists</span>
<span class="sd">                * a source node is not a rule</span>
<span class="sd">                * a target node is not a graph</span>
<span class="sd">                * addition of an edge produces paths that do not commute with</span>
<span class="sd">                some already existing paths</span>

<span class="sd">        InvalidHomomorphism</span>
<span class="sd">            If a homomorphisms from the left(right)-hand side to a graph at</span>
<span class="sd">            the target given by `lhs(rhs)_mapping` is not a valid homomorphism.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rule_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rule_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">graph_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39; is not defined in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">graph_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Source of a rule typing should be a rule, &quot;</span>
                <span class="s2">&quot;`</span><span class="si">{}</span><span class="s2">` is provided!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]))</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Target of a rule typing should be a graph, &quot;</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is provided!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">graph_id</span><span class="p">])))</span>

        <span class="c1"># check if an lhs typing is valid</span>
        <span class="n">check_homomorphism</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">graph_id</span><span class="p">][</span><span class="s2">&quot;graph&quot;</span><span class="p">],</span>
            <span class="n">lhs_mapping</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="n">lhs_total</span>
        <span class="p">)</span>

        <span class="n">new_rhs_mapping</span> <span class="o">=</span> <span class="n">rhs_mapping</span>
        <span class="k">if</span> <span class="n">new_rhs_mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_rhs_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">p_keys</span> <span class="o">=</span> <span class="n">keys_by_value</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">p_rhs</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">p_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lhs_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">new_rhs_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">lhs_mapping</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">type_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_keys</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">p_lhs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lhs_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">type_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lhs_mapping</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                        <span class="s2">&quot;Invalid rule typing: rule merges nodes of different &quot;</span>
                        <span class="s2">&quot;types (types that being merged: </span><span class="si">{}</span><span class="s2">)!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">type_set</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_set</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_rhs_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">type_set</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># check if an rhs typing is valid</span>
        <span class="n">check_homomorphism</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">graph_id</span><span class="p">][</span><span class="s2">&quot;graph&quot;</span><span class="p">],</span>
            <span class="n">new_rhs_mapping</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="n">rhs_total</span>
        <span class="p">)</span>

        <span class="c1"># check if newly created path commutes with existing shortest paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_rule_typing</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">lhs_mapping</span><span class="p">,</span> <span class="n">new_rhs_mapping</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normalize_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_edge</span><span class="p">(</span>
            <span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;lhs_mapping&quot;</span><span class="p">:</span> <span class="n">lhs_mapping</span><span class="p">,</span>
                <span class="s2">&quot;rhs_mapping&quot;</span><span class="p">:</span> <span class="n">new_rhs_mapping</span><span class="p">,</span>
                <span class="s2">&quot;lhs_total&quot;</span><span class="p">:</span> <span class="n">lhs_total</span><span class="p">,</span>
                <span class="s2">&quot;rhs_total&quot;</span><span class="p">:</span> <span class="n">rhs_total</span><span class="p">,</span>
                <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="n">attrs</span>
            <span class="p">},</span>
            <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="NXHierarchy.get_rule_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.get_rule_typing">[docs]</a>    <span class="k">def</span> <span class="nf">get_rule_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get typing dict of `source` by `target` (`source` is rule).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span><span class="s2">&quot;Hierarchy node &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a rule&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">rule_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">graph_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Rule &#39;</span><span class="si">{}</span><span class="s2">&#39; is not typed by the graph &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">))</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)[</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span>
        <span class="n">lhs_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">)[</span><span class="s2">&quot;lhs_mapping&quot;</span><span class="p">]</span>
        <span class="n">rhs_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">)[</span><span class="s2">&quot;rhs_mapping&quot;</span><span class="p">]</span>
        <span class="n">p_typing</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">rhs_typing</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">p_rhs</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">lhs_typing</span><span class="p">,</span> <span class="n">p_typing</span><span class="p">,</span> <span class="n">rhs_typing</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.is_graph"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.is_graph">[docs]</a>    <span class="k">def</span> <span class="nf">is_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if a hierarchy node is a graph.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;graph&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.is_rule"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.is_rule">[docs]</a>    <span class="k">def</span> <span class="nf">is_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if a hierarchy node is a rule.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;rule&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.is_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.is_typing">[docs]</a>    <span class="k">def</span> <span class="nf">is_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if a hierarchy edge is a typing.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;mapping&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.is_rule_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.is_rule_typing">[docs]</a>    <span class="k">def</span> <span class="nf">is_rule_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test if a hierarchy edge is a rule typing.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;lhs_mapping&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.remove_node"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.remove_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">reconnect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove node from the hierarchy.</span>

<span class="sd">        Removes a node from the hierarchy, if the `reconnect`</span>
<span class="sd">        parameter is set to True, adds typing from the</span>
<span class="sd">        predecessors of the removed node to all its successors,</span>
<span class="sd">        by composing the homomorphisms (for every predecessor `p`</span>
<span class="sd">        and for every successor &#39;s&#39; composes two homomorphisms</span>
<span class="sd">        `p`-&gt;`node_id` and `node_id`-&gt;`s`, then removes `node_id` and</span>
<span class="sd">        all its incident edges, by which makes node&#39;s</span>
<span class="sd">        removal a procedure of &#39;forgetting&#39; one level</span>
<span class="sd">        of &#39;abstraction&#39;).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_id</span>
<span class="sd">            Id of a node to remove</span>
<span class="sd">        reconnect : bool</span>
<span class="sd">            Reconnect the descendants of the removed node to</span>
<span class="sd">            its predecessors</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HierarchyError</span>
<span class="sd">            If node with `node_id` is not defined in the hierarchy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Node &#39;</span><span class="si">{}</span><span class="s2">&#39;&#39; is not defined in the hierarchy!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">reconnect</span><span class="p">:</span>
            <span class="n">out_graphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
            <span class="n">in_graphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">in_graphs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">out_graphs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule_typing</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
                        <span class="n">lhs_map</span><span class="p">,</span> <span class="n">rhs_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule_typing</span><span class="p">(</span>
                            <span class="n">source</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>
                        <span class="n">new_lhs_map</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                            <span class="n">lhs_map</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">new_rhs_map</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                            <span class="n">rhs_map</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_rule_typing</span><span class="p">(</span>
                                <span class="n">source</span><span class="p">,</span>
                                <span class="n">target</span><span class="p">,</span>
                                <span class="n">new_lhs_map</span><span class="p">,</span>
                                <span class="n">new_rhs_map</span>
                            <span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_typing</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
                        <span class="c1"># compose two homomorphisms</span>
                        <span class="n">mapping</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">node_id</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_typing</span><span class="p">(</span>
                                <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>

        <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>

        <span class="c1"># Update dicts representing relations</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="n">node_id</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">node_id</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="NXHierarchy.remove_rule"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.remove_rule">[docs]</a>    <span class="k">def</span> <span class="nf">remove_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">reconnect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove graph from the hierarchy.</span>

<span class="sd">        Removes a rule from the hierarchy, if the `reconnect`</span>
<span class="sd">        parameter is set to True, adds typing from the</span>
<span class="sd">        predecessors of the removed node to all its successors,</span>
<span class="sd">        by composing the homomorphisms (for every predecessor `p`</span>
<span class="sd">        and for every successor &#39;s&#39; composes two homomorphisms</span>
<span class="sd">        `p`-&gt;`node_id` and `node_id`-&gt;`s`, then removes `node_id` and</span>
<span class="sd">        all its incident edges, by which makes node&#39;s</span>
<span class="sd">        removal a procedure of &#39;forgetting&#39; one level</span>
<span class="sd">        of &#39;abstraction&#39;).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rule_id</span>
<span class="sd">            Id of a rule to remove</span>
<span class="sd">        reconnect : bool</span>
<span class="sd">            Reconnect the descendants of the removed node to</span>
<span class="sd">            its predecessors</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HierarchyError</span>
<span class="sd">            If graph with `node_id` is not defined in the hierarchy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                <span class="s2">&quot;Hierarchy node &#39;</span><span class="si">{}</span><span class="s2">&#39; is a graph! &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span> <span class="o">+</span>
                <span class="s2">&quot;Use, &#39;remove_graph&#39; method instead&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">reconnect</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.compose_path_typing"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.compose_path_typing">[docs]</a>    <span class="k">def</span> <span class="nf">compose_path_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compose homomorphisms along the path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : list</span>
<span class="sd">            List of nodes of the hierarchy forming a path</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        If source node of the path is a graph</span>

<span class="sd">        homomorphism : dict</span>
<span class="sd">            Dictionary containg the typing of the nodes</span>
<span class="sd">            from the source graph of the path by the nodes</span>
<span class="sd">            of the target graph</span>

<span class="sd">        if source node of the path is a rule</span>

<span class="sd">        lhs_homomorphism : dict</span>
<span class="sd">            Dictionary containg the typing of the nodes</span>
<span class="sd">            from the left-hand side of the source rule</span>
<span class="sd">            of the path by the nodes of the target graph</span>
<span class="sd">        rhs_homomorphism : dict</span>
<span class="sd">            Dictionary containg the typing of the nodes</span>
<span class="sd">            from the right-hand side of the source rule</span>
<span class="sd">            of the path by the nodes of the target graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">homomorphism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">homomorphism</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                    <span class="n">homomorphism</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">homomorphism</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lhs_typing</span><span class="p">,</span> <span class="n">p_typing</span><span class="p">,</span> <span class="n">rhs_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule_typing</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">lhs_typing</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                    <span class="n">lhs_typing</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">p_typing</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                    <span class="n">p_typing</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">rhs_typing</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                    <span class="n">rhs_typing</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">lhs_typing</span><span class="p">,</span> <span class="n">p_typing</span><span class="p">,</span> <span class="n">rhs_typing</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.copy"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.copy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hierarchy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy the hierarchy object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.find_rule_matching"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.find_rule_matching">[docs]</a>    <span class="k">def</span> <span class="nf">find_rule_matching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find matching of a rule `rule_id` form the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ReGraphError</span><span class="p">(</span>
                <span class="s2">&quot;Pattern matching in a rule is not implemented!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span><span class="s2">&quot;Invalid rule &#39;</span><span class="si">{}</span><span class="s2">&#39; to match!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rule_id</span><span class="p">))</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="s2">&quot;rule&quot;</span><span class="p">]</span>

        <span class="n">lhs_typing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">rhs_typing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">rule_successors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">suc</span> <span class="ow">in</span> <span class="n">rule_successors</span><span class="p">:</span>
            <span class="n">lhs_typing</span><span class="p">[</span><span class="n">suc</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="n">suc</span><span class="p">][</span><span class="s2">&quot;lhs_mapping&quot;</span><span class="p">]</span>
            <span class="n">rhs_typing</span><span class="p">[</span><span class="n">suc</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="n">suc</span><span class="p">][</span><span class="s2">&quot;rhs_mapping&quot;</span><span class="p">]</span>

        <span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_matching</span><span class="p">(</span>
            <span class="n">graph_id</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span>
            <span class="n">lhs_typing</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">instances</span></div>

    <span class="k">def</span> <span class="nf">_update_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">graph_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the graph object stored at the node of with id &#39;graph_id&#39;.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_node_attrs</span><span class="p">(</span>
            <span class="n">graph_id</span><span class="p">,</span> <span class="p">{</span>
                <span class="s2">&quot;graph&quot;</span><span class="p">:</span> <span class="n">graph_obj</span><span class="p">,</span>
                <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">graph_id</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the mapping dictionary from source to target.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_edge_attrs</span><span class="p">(</span>
                <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s2">&quot;mapping&quot;</span><span class="p">:</span> <span class="n">mapping</span><span class="p">,</span>
                    <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing_attrs</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="p">},</span>
                <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">mapping</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_rule_homomorphism</span><span class="p">(</span>
                <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_relation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">relation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the relation dictionaries (left and right).&quot;&quot;&quot;</span>
        <span class="n">old_attrs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relation_edges</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_relation</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_relation</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">old_attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">rule_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the rule object stored at the node of with id &#39;rule_id&#39;.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_node_attrs</span><span class="p">(</span>
            <span class="n">rule_id</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="n">rule_obj</span><span class="p">,</span>
                <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_rule_homomorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">lhs_h</span><span class="p">,</span> <span class="n">rhs_h</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_edge_attrs</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;lhs_mapping&quot;</span><span class="p">:</span> <span class="n">lhs_h</span><span class="p">,</span>
                <span class="s2">&quot;rhs_mapping&quot;</span><span class="p">:</span> <span class="n">rhs_h</span><span class="p">,</span>
                <span class="s2">&quot;attrs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing_attrs</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graphs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">homomorphisms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">rules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rule_homomorphisms</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update parts of hierarchy with new objects.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">graphs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">graphs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">homomorphisms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">homomorphisms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">relations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relations</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rules</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rule_homomorphisms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule_homomorphisms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">graph</span><span class="p">,</span> <span class="n">graph_obj</span> <span class="ow">in</span> <span class="n">graphs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">graph_obj</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="n">homomorphisms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_mapping</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">relations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_relation</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">relation</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rule</span><span class="p">,</span> <span class="n">rule_obj</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">rule_obj</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="n">lhs_h</span><span class="p">,</span> <span class="n">rhs_h</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rule_homomorphisms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_rule_homomorphism</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">lhs_h</span><span class="p">,</span> <span class="n">rhs_h</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_restrictive_update_incident_homs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update incident homomorphisms after a restrictive change.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">suc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
            <span class="n">typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">suc</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_mapping</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">suc</span><span class="p">,</span> <span class="n">compose</span><span class="p">(</span><span class="n">g_m_g</span><span class="p">,</span> <span class="n">typing</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_rule_homomorphism</span><span class="p">(</span>
                    <span class="n">node_id</span><span class="p">,</span> <span class="n">suc</span><span class="p">,</span>
                    <span class="n">compose</span><span class="p">(</span><span class="n">g_m_g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">typing</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="n">compose</span><span class="p">(</span><span class="n">g_m_g</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">typing</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_restrictive_update_incident_rels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update incident relations after a restrictive change.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">related_g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacent_relations</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
                <span class="n">rel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relation</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">related_g</span><span class="p">)</span>
                <span class="n">new_rel</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                    <span class="n">old_node</span> <span class="o">=</span> <span class="n">g_m_g</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">old_node</span> <span class="ow">in</span> <span class="n">rel</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">new_rel</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">rel</span><span class="p">[</span><span class="n">old_node</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_update_relation</span><span class="p">(</span><span class="n">graph_id</span><span class="p">,</span> <span class="n">related_g</span><span class="p">,</span> <span class="n">new_rel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_expansive_update_incident_homs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">g_m_g_prime</span><span class="p">,</span>
                                        <span class="n">pred_typings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update incident homomorphisms after an expansive change.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pred</span><span class="p">,</span> <span class="n">typing</span> <span class="ow">in</span> <span class="n">pred_typings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">pred</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_mapping</span><span class="p">(</span>
                    <span class="n">pred</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">compose</span><span class="p">(</span><span class="n">typing</span><span class="p">,</span> <span class="n">g_m_g_prime</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_rule_homomorphism</span><span class="p">(</span>
                    <span class="n">pred</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span>
                    <span class="n">compose</span><span class="p">(</span><span class="n">typing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">g_m_g_prime</span><span class="p">),</span>
                    <span class="n">compose</span><span class="p">(</span><span class="n">typing</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g_m_g_prime</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_expansive_update_incident_rels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">g_m_g_prime</span><span class="p">,</span>
                                        <span class="n">adj_relations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update incident relations after an expansive change.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">related_g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacent_relations</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">related_g</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_expansive_update_incident_rels</span><span class="p">(</span>
                    <span class="n">graph_id</span><span class="p">,</span> <span class="n">g_m_g_prime</span><span class="p">,</span> <span class="n">adj_relations</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

<div class="viewcode-block" id="NXHierarchy.apply_rule"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.apply_rule">[docs]</a>    <span class="k">def</span> <span class="nf">apply_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply rule from the hierarchy.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">graph_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ReGraphError</span><span class="p">(</span><span class="s2">&quot;Rewriting of a rule is not implemented!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rule</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">RewritingError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid rewriting rule &#39;</span><span class="si">{}</span><span class="s2">&#39;!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rule_id</span><span class="p">))</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span>

        <span class="n">lhs_typing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">rhs_typing</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">rule_successors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">rule_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">suc</span> <span class="ow">in</span> <span class="n">rule_successors</span><span class="p">:</span>
            <span class="n">lhs_typing</span><span class="p">[</span><span class="n">suc</span><span class="p">]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="n">suc</span><span class="p">][</span><span class="s2">&quot;lhs_mapping&quot;</span><span class="p">]</span>
            <span class="n">rhs_typing</span><span class="p">[</span><span class="n">suc</span><span class="p">]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">rule_id</span><span class="p">][</span><span class="n">suc</span><span class="p">][</span><span class="s2">&quot;rhs_mapping&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span>
            <span class="n">graph_id</span><span class="p">,</span>
            <span class="n">rule</span><span class="p">,</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">rhs_typing</span><span class="o">=</span><span class="n">rhs_typing</span><span class="p">)</span></div>

<div class="viewcode-block" id="NXHierarchy.to_json"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.to_json">[docs]</a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rename_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert hierarchy to its json representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">rename_nodes</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_rule_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">lhs_mapping</span><span class="p">,</span> <span class="n">rhs_mapping</span><span class="p">):</span>
        <span class="n">all_paths</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">all_pairs_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">))</span>

        <span class="n">paths_from_target</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">graph_id</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">[</span><span class="n">graph_id</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">paths_from_target</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_paths</span><span class="p">[</span><span class="n">graph_id</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">paths_from_target</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">graph_id</span><span class="p">:</span>
                <span class="n">new_lhs_h</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                    <span class="n">lhs_mapping</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">paths_from_target</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
                <span class="n">new_rhs_h</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
                    <span class="n">rhs_mapping</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">paths_from_target</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># find homomorphisms from s to t via other paths</span>
                    <span class="n">s_t_paths</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">all_shortest_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">,</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">s_t_paths</span><span class="p">:</span>
                        <span class="n">lhs_h</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">rhs_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compose_path_typing</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lhs_h</span> <span class="o">!=</span> <span class="n">new_lhs_h</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                                <span class="s2">&quot;Invalid lhs typing: homomorphism does not &quot;</span>
                                <span class="s2">&quot;commute with an existing &quot;</span>
                                <span class="s2">&quot;path from &#39;</span><span class="si">{}</span><span class="s2">&#39; to &#39;</span><span class="si">{}</span><span class="s2">&#39;!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="n">rhs_h</span> <span class="o">!=</span> <span class="n">new_rhs_h</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">HierarchyError</span><span class="p">(</span>
                                <span class="s2">&quot;Invalid rhs typing: homomorphism does not &quot;</span>
                                <span class="s2">&quot;commute with an existing &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;path from &#39;</span><span class="si">{}</span><span class="s2">&#39; to &#39;</span><span class="si">{}</span><span class="s2">&#39;!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="p">)</span>
                <span class="k">except</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">):</span>
                    <span class="k">pass</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_get_identity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lhs_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">p_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">rhs_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rule</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">lhs_map</span><span class="p">,</span> <span class="n">p_map</span><span class="p">,</span> <span class="n">rhs_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_restore_by_backward_composability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">,</span> <span class="n">g_m_origin_ms</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">target_id</span><span class="p">):</span>
            <span class="n">graph_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">target_id</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">target_id</span><span class="p">):</span>
                <span class="n">pred_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">pred</span><span class="p">):</span>
                    <span class="n">pred_graph</span> <span class="o">=</span> <span class="n">get_unique_map_to_pullback</span><span class="p">(</span>
                        <span class="n">graph_nodes</span><span class="p">,</span>
                        <span class="n">g_m_g</span><span class="p">,</span>
                        <span class="n">g_m_origin_ms</span><span class="p">[</span><span class="n">target_id</span><span class="p">],</span>
                        <span class="n">pred_typing</span><span class="p">,</span>
                        <span class="n">g_m_origin_ms</span><span class="p">[</span><span class="n">pred</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_typing</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_typing</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target_id</span><span class="p">,</span> <span class="n">pred_graph</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lhs_typing</span><span class="p">,</span> <span class="n">rhs_typing</span> <span class="o">=</span> <span class="n">pred_typing</span>
                    <span class="n">lhs_pred_graph</span> <span class="o">=</span> <span class="n">get_unique_map_to_pullback</span><span class="p">(</span>
                        <span class="n">graph_nodes</span><span class="p">,</span>
                        <span class="n">g_m_g</span><span class="p">,</span>
                        <span class="n">g_m_origin_ms</span><span class="p">[</span><span class="n">target_id</span><span class="p">],</span>
                        <span class="n">lhs_typing</span><span class="p">,</span>
                        <span class="n">g_m_origin_ms</span><span class="p">[</span><span class="n">pred</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rhs_pred_graph</span> <span class="o">=</span> <span class="n">get_unique_map_to_pullback</span><span class="p">(</span>
                        <span class="n">graph_nodes</span><span class="p">,</span>
                        <span class="n">g_m_g</span><span class="p">,</span>
                        <span class="n">g_m_origin_ms</span><span class="p">[</span><span class="n">target_id</span><span class="p">],</span>
                        <span class="n">rhs_typing</span><span class="p">,</span>
                        <span class="n">g_m_origin_ms</span><span class="p">[</span><span class="n">pred</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_typing</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_rule_typing</span><span class="p">(</span>
                        <span class="n">pred</span><span class="p">,</span> <span class="n">target_id</span><span class="p">,</span> <span class="n">lhs_pred_graph</span><span class="p">,</span> <span class="n">rhs_pred_graph</span><span class="p">)</span>

<div class="viewcode-block" id="NXHierarchy.relabel_nodes"><a class="viewcode-back" href="../../../../nxhierarchies.html#regraph.backends.networkx.hierarchies.NXHierarchy.relabel_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">relabel_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Relabel nodes of a graph in the hierarchy.&quot;&quot;&quot;</span>
        <span class="n">graph_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">graph_obj</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

        <span class="c1"># update homomorphisms</span>
        <span class="k">for</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
            <span class="n">old_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">predecessor</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_mapping</span><span class="p">(</span>
                <span class="n">predecessor</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">compose</span><span class="p">(</span><span class="n">old_typing</span><span class="p">,</span> <span class="n">mapping</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
            <span class="n">old_typing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typing</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">successor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_mapping</span><span class="p">(</span>
                <span class="n">graph</span><span class="p">,</span> <span class="n">successor</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="n">mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">old_typing</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="c1"># update relations</span>
        <span class="k">for</span> <span class="n">adj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacent_relations</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
            <span class="n">old_rel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relation</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_relation</span><span class="p">(</span>
                <span class="n">graph</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="n">mapping</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">old_rel</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">)</span></div>

    <span class="c1"># def _compose_backward(self, pred_id, graph_id, g_m_g, graph_m_origin_m,</span>
    <span class="c1">#                       pred_m_origin_m, pred_typing):</span>
    <span class="c1">#     graph_nodes = self.get_graph(graph_id).nodes()</span>
    <span class="c1">#     return get_unique_map_to_pullback(</span>
    <span class="c1">#         graph_nodes,</span>
    <span class="c1">#         g_m_g,</span>
    <span class="c1">#         graph_m_origin_m,</span>
    <span class="c1">#         pred_typing,</span>
    <span class="c1">#         pred_m_origin_m)</span>

    <span class="k">def</span> <span class="nf">_compose_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">,</span> <span class="n">graph_m_origin_m</span><span class="p">,</span>
                          <span class="n">pred_m_origin_m</span><span class="p">,</span> <span class="n">pred_typing</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_graph</span><span class="p">(</span><span class="n">pred_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_compose_backward</span><span class="p">(</span>
                <span class="n">pred_id</span><span class="p">,</span> <span class="n">graph_id</span><span class="p">,</span> <span class="n">g_m_g</span><span class="p">,</span> <span class="n">graph_m_origin_m</span><span class="p">,</span>
                <span class="n">pred_m_origin_m</span><span class="p">,</span> <span class="n">pred_typing</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># rule = self.get_rule(graph_id)</span>
            <span class="c1"># lhs_nodes = rule.lhs.nodes()</span>
            <span class="c1"># rhs_nodes = rule.rhs.nodes()</span>
            <span class="n">graph_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">(</span><span class="n">graph_id</span><span class="p">)</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>

            <span class="n">lhs_typing</span><span class="p">,</span> <span class="n">rhs_typing</span> <span class="o">=</span> <span class="n">pred_typing</span>
            <span class="n">pred_m_origin_m_lhs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">pred_m_origin_m_rhs</span> <span class="o">=</span> <span class="n">pred_m_origin_m</span>

            <span class="n">lhs_hom</span> <span class="o">=</span> <span class="n">get_unique_map_to_pullback</span><span class="p">(</span>
                <span class="n">graph_nodes</span><span class="p">,</span>
                <span class="n">g_m_g</span><span class="p">,</span>
                <span class="n">graph_m_origin_m</span><span class="p">,</span>
                <span class="n">lhs_typing</span><span class="p">,</span>
                <span class="n">pred_m_origin_m_lhs</span><span class="p">)</span>

            <span class="n">rhs_hom</span> <span class="o">=</span> <span class="n">get_unique_map_to_pullback</span><span class="p">(</span>
                <span class="n">graph_nodes</span><span class="p">,</span>
                <span class="n">g_m_g</span><span class="p">,</span>
                <span class="n">graph_m_origin_m</span><span class="p">,</span>
                <span class="n">rhs_typing</span><span class="p">,</span>
                <span class="n">pred_m_origin_m_lhs</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">lhs_hom</span><span class="p">,</span> <span class="n">rhs_hom</span><span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">ReGraph</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Eugenia Oshurko.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>